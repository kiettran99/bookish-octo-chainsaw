@using System.Collections.Generic
@using System.Text.Json
@inject IConfiguration Configuration

@{
    var reviewTagCatalog = new Dictionary<string, string[]>
    {
        ["Nội dung phim"] = new[] { "Thiếu chiều sâu", "Cốt truyện khó hiểu", "Nhịp phim hợp lý", "Plot twist bất ngờ" },
        ["Diễn xuất"] = new[] { "Diễn xuất ấn tượng", "Chemistry chưa tốt", "Vai phụ nổi bật", "Lời thoại khiên cưỡng" },
        ["Âm thanh & hình ảnh"] = new[] { "Âm thanh sống động", "Nhạc phim chưa đắt", "Kỹ xảo mãn nhãn", "Chuyển cảnh chưa mượt" },
        ["Trải nghiệm rạp"] = new[] { "Màn chiếu rõ nét", "Ghế ngồi chưa thoải mái", "Dịch vụ tốt", "Không khí sôi động" }
    };
    var catalogJson = JsonSerializer.Serialize(reviewTagCatalog);
    var apiBaseUrl = Configuration["CineReviewApi:BaseUrl"] ?? "";
}

<div data-review-sheet-root data-review-catalog='@Html.Raw(catalogJson)' data-api-base-url="@apiBaseUrl">
    <div class="review-layer" data-review-layer hidden>
        <div class="review-layer__backdrop" data-review-close></div>
    <section class="review-sheet">
            <header class="review-sheet__header">
                <div>
                    <p class="review-sheet__eyebrow">Viết review</p>
                    <h3 id="reviewSheetTitle">Chia sẻ cảm nhận của bạn</h3>
                    <p class="review-sheet__intro">Chọn nhanh bằng tag để review hiển thị ngay hoặc nhập nội dung chi tiết (sẽ được duyệt trước khi lên trang).</p>
                </div>
                <button type="button" class="btn btn-ghost btn-sm" data-review-close>Đóng</button>
            </header>
            <div class="review-sheet__body">
                <div class="review-sheet__mode-switch" role="tablist">
                    <button type="button" role="tab" class="review-mode-button is-active" data-review-mode="template">Theo tag có sẵn</button>
                    <button type="button" role="tab" class="review-mode-button" data-review-mode="freeform">Viết tự do</button>
                </div>

                <div class="review-sheet__section" data-review-template-section>
                    <label class="form-label" for="reviewCategory">Chủ đề chính</label>
                    <select id="reviewCategory" class="form-select" data-review-category>
                        <option value="" disabled hidden selected>Chọn chủ đề</option>
                        @foreach (var category in reviewTagCatalog.Keys)
                        {
                            <option value="@category">@category</option>
                        }
                    </select>
                </div>

                <div class="review-sheet__section" data-review-template-section>
                    <label class="form-label" for="reviewTag">Đánh giá cụ thể</label>
                    <select id="reviewTag" class="form-select" data-review-tag disabled>
                        <option value="" disabled hidden selected>Chọn nhận xét</option>
                    </select>
                    <div class="review-sheet__hint">Review dạng tag sẽ hiển thị ngay sau khi gửi.</div>
                </div>

                <div class="review-sheet__section" data-review-freeform-section hidden>
                    <label class="form-label" for="freeformReview">Chia sẻ chi tiết</label>
                    <textarea id="freeformReview" class="form-control" rows="6" placeholder="Hãy kể rõ trải nghiệm rạp, cảm xúc sau khi xem…" data-review-freeform></textarea>
                    <div class="review-sheet__hint review-sheet__hint--warning">Review bằng chữ sẽ được đội ngũ duyệt trước khi hiển thị.</div>
                </div>
            </div>
            <footer class="review-sheet__footer">
                <button type="button" class="btn btn-ghost" data-review-close>Huỷ</button>
                <button type="button" class="btn btn-primary" data-review-submit disabled>Gửi review</button>
            </footer>

            <div class="review-sheet__loader" data-review-loader hidden role="status" aria-live="assertive">
                <div class="spinner-border text-info" role="status"></div>
                <span>Đang gửi review...</span>
            </div>
        </section>
    </div>

    <div class="review-dialog" data-review-confirm hidden role="alertdialog" aria-modal="true" aria-labelledby="reviewSubmitConfirmTitle">
        <div class="review-dialog__backdrop"></div>
        <div class="review-dialog__panel">
            <h3 id="reviewSubmitConfirmTitle">Xác nhận gửi review</h3>
            <p>Bạn xác nhận muốn gửi review này chứ? Hệ thống sẽ hiển thị trạng thái ngay sau khi gửi.</p>
            <div class="review-dialog__summary">
                <ul data-review-summary-template>
                    <li><span>Chủ đề</span><span data-summary-category></span></li>
                    <li><span>Nhận xét</span><span data-summary-tag></span></li>
                </ul>
                <p data-review-summary-freeform hidden></p>
            </div>
            <div class="review-dialog__actions">
                <button type="button" class="btn btn-ghost" data-review-confirm-cancel>Xem lại</button>
                <button type="button" class="btn btn-primary" data-review-confirm-send>Gửi ngay</button>
            </div>
        </div>
    </div>

    <div class="review-dialog" data-review-status hidden role="alertdialog" aria-modal="true" aria-labelledby="reviewStatusTitle">
        <div class="review-dialog__backdrop"></div>
        <div class="review-dialog__panel">
            <div class="review-dialog__status">
                <i class="review-dialog__status-icon" data-review-status-icon></i>
                <div>
                    <h3 id="reviewStatusTitle" data-review-status-title></h3>
                    <p data-review-status-description></p>
                </div>
            </div>
            <div class="review-dialog__actions" data-review-status-success hidden>
                <button type="button" class="btn btn-ghost" data-review-start-another>Viết thêm review</button>
                <button type="button" class="btn btn-primary" data-review-close-complete>Hoàn tất</button>
            </div>
            <div class="review-dialog__actions" data-review-status-failure hidden>
                <button type="button" class="btn btn-ghost" data-review-retry>Thử lại</button>
                <button type="button" class="btn btn-primary" data-review-dismiss-status>Đóng</button>
            </div>
        </div>
    </div>

    <!-- Dialog: Your Review -->
    <div class="review-dialog" data-your-review-dialog hidden role="dialog" aria-modal="true" aria-labelledby="yourReviewTitle">
        <div class="review-dialog__backdrop" data-your-review-close></div>
        <div class="review-dialog__panel">
            <div class="d-flex justify-content-between align-items-start mb-3">
                <h3 id="yourReviewTitle">Review của bạn</h3>
                <button type="button" class="btn-close" data-your-review-close aria-label="Đóng"></button>
            </div>
            
            <div class="review-dialog__summary">
                <div class="mb-3">
                    <span class="badge bg-info" data-your-review-type></span>
                    <span class="badge bg-secondary ms-2" data-your-review-status></span>
                </div>
                <div class="mb-3">
                    <div class="fw-semibold text-white mb-1">Nội dung:</div>
                    <p class="text-secondary mb-0" data-your-review-content></p>
                </div>
                <div class="mb-3">
                    <div class="fw-semibold text-white mb-1">Đánh giá:</div>
                    <div class="text-warning" data-your-review-rating></div>
                </div>
                <div class="mb-3">
                    <div class="fw-semibold text-white mb-1">Tương tác:</div>
                    <div class="d-flex gap-3 text-secondary">
                        <span><i class="bi bi-hand-thumbs-up"></i> <span data-your-review-fair>0</span> công tâm</span>
                        <span><i class="bi bi-hand-thumbs-down"></i> <span data-your-review-unfair">0</span> không công tâm</span>
                    </div>
                </div>
                <div>
                    <div class="fw-semibold text-white mb-1">Điểm đánh giá:</div>
                    <div class="text-info fs-5" data-your-review-score>0.0</div>
                </div>
            </div>

            <div class="review-dialog__actions">
                <button type="button" class="btn btn-secondary" data-your-review-close>Đóng</button>
            </div>
        </div>
    </div>
</div>
